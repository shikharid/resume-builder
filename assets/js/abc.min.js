jQuery(document).ready(function($) {
	

	var oldval;

	var elemType;

	// var arPanels  = {
	// 	'panelCount' : 0,
	// 	'inputCount' : 0,
	// 	'submitButtonCount' : 0,
	// 	'headingCount' : 0,
	// 	'panel' : {},


	// 	addPanel : function(){
	// 		var panelno = this.panelCount + 1; 
	// 		panel[panelno] = {};
	// 	},

	// 	addHeading : function(panelId) {
	// 		panel[panelId] = {
	// 			heading
	// 		}
	// 	}
	// };

	var $tool_box_controls = $('#tool-box-controls'),

		$work_area = $('#work-area'),

		$dynamic_controls =  $('#dynamic-controls'),

		$trash = $('#trash'),

		$panels = $('#panels');


	$('ul > li > a').on('click', function(event) {
		event.preventDefault();
		/* Act on the event */
	});

	$work_area.on('click', '.trash', function(event) {
		$parent = $(this).closest('li').remove();
		event.preventDefault();
		/* Act on the event */
	});
	$work_area.on('dblclick','ol > li',function() {
		var $elem = $(this);

		if($elem.hasClass('placeholder')){
			return ;
		}

		var type = $elem.attr('data-elem');

		if(type=="submitButton" || type == "textField") {
			oldval = $elem.val();
		}
		else {
			oldval = $elem.text();
		}

		//console.log(type);
		//if(type=="heading" || type == "paragraph") {
			$elem.html('<input type="text" placeholder="Enter '+type+' text" class="edit-data" placeholder=""/>').find('input').focus();
		//}
	});

	$('#work-area').on('focusout','input',function() {
			var newval = $(this).val();
			var closestelem;

			closestelem = $(this).closest('li');
			if(newval=="")
				newval = oldval;

			var elemType = closestelem.attr('data-elem');

			switch(elemType) {
				case 'heading' : 
					closestelem.html('<li data-elem="'+elemType+'"><h3>'+newval+'</h3></li>');
					break;
				case 'paragraph': 
					closestelem.html('<li data-elem="'+elemType+'"><p>'+newval+'</p></li>');
					break;
				case 'textField' : 
					closestelem.html('<li data-elem="'+elemType+'"><input type="text" value="'+newval+'"/></li>');
					break;
				case 'submitButton' : 
					closestelem.html('<li data-elem="'+elemType+'"><input type="submit" value="'+newval+'"/></li>');
					break;
				default : 
					break;

			}
		});

	


	$("li", $tool_box_controls).draggable({
		revert : "invalid",
		 helper : "clone",
		 cursor : "move"

	});

	$trash.droppable({

		drop : function(event, ui) {
		}
	});


	$("li",$dynamic_controls).draggable({
		cursor : "move"
	});

	//$dynamic_controls.sortable();


	$dynamic_controls.droppable({
		accept : '#tool-box-controls> li[data-elem="panel"]',
		drop : function(event, ui) {
			addControl(ui.draggable,$(this));
		}
	}).sortable({
		containment : "document",
		revert : "invalid",
		cursor : "move"
	});

	function addControl($control, $context) {

		$type = $control.attr('data-elem');

		switch($type) {
			case "heading" : addHeading($control, $context);
				break;
			case "paragraph" : addParagraph($control, $context);
				break;
			case "panel" : addPanel($control, $context);
				break;
			case "textField" : addTextField($control, $context);
				break;
			case "submitButton" : addSubmitButton($control, $context);
				break;
			default : 
				break;
		}
	}

	function addHeading($control, $context) {

		var $data = $('<li data-elem="heading"><h3>Heading <span class="notice-text">(Double click to change)</span></h3><span class="trash"></span></li>');

		$data.appendTo($context);
	}

	function addParagraph($control, $context) {

		var $data = $('<li data-elem="paragraph"><p>Paragraph <span class="notice-text">(Double click to change)</span></p><span class="trash"></span></li>');
		$data.appendTo($context);
	}

	function addTextField($control, $context) {
		//console.log("Paragraph : "+ $context.hasClass('dynamic-panel'));
		var $data = $('<li data-elem="textField"><input type="text" placeholder="Enter Value"><span class="trash"></span></li>');
		$data.appendTo($context);
	}

	function addSubmitButton($control, $context) {
		var $data = $('<li data-elem="submitButton"><input type="submit" value="Button"><span class="trash"></span></li>');
		$data.appendTo($context);
	}
	function addPanel($control,$context) {

			var $newpanel = $('<ol class="dynamic-panel" id="panel-'+(arPanel.panelCount+1)+'"><li class="placeholder"><h3>Panel <span class="notice-text">Add Controls Here</span></h3><span class="trash"></span></li></ol>').droppable({
				accept: ":not(.ui-sortable-helper) ", //:not('#tool-box-controls > li[data-elem=\"panel\"]')",
				greedy : true,
				drop : function(event, ui) {
					$(this).find('.placeholder').remove();
					addControl(ui.draggable, $(this));
				}
			}).sortable({
				containment : "parent",
				cursor : "move",
			}).appendTo($context);

			// arPanel.panel();

			// console.log(arPanels.panelCount);

	}
});
